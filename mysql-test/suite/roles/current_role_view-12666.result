CREATE USER has_role@'localhost';
GRANT ALL PRIVILEGES ON *.* TO has_role@'localhost';
CREATE ROLE test_role;
GRANT test_role TO has_role@'localhost';
CREATE USER no_role@'localhost';
GRANT ALL PRIVILEGES ON *.* TO no_role@'localhost';
CREATE TABLE view_role_test (
id int primary key,
role_name varchar(50)
);
INSERT INTO view_role_test VALUES (1, 'test_role');
CREATE OR REPLACE 
DEFINER = no_role@localhost
SQL SECURITY INVOKER
VIEW v_view_role_test
AS
SELECT * FROM view_role_test WHERE role_name = CURRENT_ROLE();
show create view v_view_role_test;
View	Create View	character_set_client	collation_connection
v_view_role_test	CREATE ALGORITHM=UNDEFINED DEFINER=`no_role`@`localhost` SQL SECURITY INVOKER VIEW `v_view_role_test` AS select `view_role_test`.`id` AS `id`,`view_role_test`.`role_name` AS `role_name` from `view_role_test` where (`view_role_test`.`role_name` = current_role())	latin1	latin1_swedish_ci
SET ROLE test_role;
CREATE OR REPLACE 
DEFINER = no_role@localhost
SQL SECURITY INVOKER
VIEW v_view_role_test_2
AS
SELECT * FROM view_role_test WHERE role_name = CURRENT_ROLE();
show create view v_view_role_test_2;
View	Create View	character_set_client	collation_connection
v_view_role_test_2	CREATE ALGORITHM=UNDEFINED DEFINER=`no_role`@`localhost` SQL SECURITY INVOKER VIEW `v_view_role_test_2` AS select `view_role_test`.`id` AS `id`,`view_role_test`.`role_name` AS `role_name` from `view_role_test` where (`view_role_test`.`role_name` = current_role())	latin1	latin1_swedish_ci
SELECT CURRENT_USER();
CURRENT_USER()
root@localhost
SELECT CURRENT_ROLE();
CURRENT_ROLE()
test_role
SELECT * FROM view_role_test WHERE role_name = CURRENT_ROLE();
id	role_name
1	test_role
SELECT * FROM v_view_role_test;
id	role_name
1	test_role
drop user has_role@'localhost';
drop user no_role@'localhost';
drop role test_role;
drop table view_role_test;
drop view v_view_role_test;
drop view v_view_role_test_2;
